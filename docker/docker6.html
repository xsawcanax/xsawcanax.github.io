<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dlaczego dane w kontenerach nie są trwałe?</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <h1>Dlaczego dane w kontenerach nie są trwałe?</h1>

    <p>Dane w kontenerach (takich jak kontenery Docker czy inne technologie do konteneryzacji) są zazwyczaj trwałe do momentu, gdy kontener jest uruchomiony. Jednakże, gdy kontener zostaje zatrzymany i usunięty, wszelkie zmiany dokonane w trakcie działania kontenera mogą zostać utracone. Istnieje kilka powodów, dlaczego dane w kontenerach nie są trwałe:</p>

    <ol>
        <li><strong>Model działania kontenerów:</strong>
            Kontenery są oparte na modelu działania warstwowego. Każda zmiana w kontenerze powoduje utworzenie nowej warstwy, a stara warstwa pozostaje niezmieniona. Gdy kontener jest zatrzymywany i usuwany, wszystkie zmiany wprowadzone w trakcie działania kontenera zostają utracone, ponieważ warstwy są tymczasowe i znikają wraz z kontenerem.
        </li>
        <li><strong>Skrócony cykl życia:</strong>
            Kontenery są projektowane do krótkiego cyklu życia, co oznacza, że są łatwo tworzone, uruchamiane, zatrzymywane i usuwane. To podejście ma na celu zapewnienie łatwości zarządzania infrastrukturą. Jednakże, trwałość danych często wymagałaby innego podejścia, takiego jak korzystanie z zewnętrznych zasobów (np. woluminów) czy systemów zarządzania danymi.
        </li>
        <li><strong>Domyślne zachowanie systemu plików kontenera:</strong>
            Systemy plików w kontenerach składają się z warstw obrazu oraz warstwy zapisywalnej. Modyfikowanie plików w kontenerze nie wpływa na obraz, a dane w warstwie zapisywalnej są ulotne. Oznacza to, że wszelkie zmiany dokonane w trakcie działania kontenera są przechowywane w warstwie tymczasowej, która może zostać utracona po zatrzymaniu kontenera.
        </li>
        <li><strong>Woluminy:</strong>
            Chociaż dane w warstwach kontenera mogą być nietrwałe, można korzystać z mechanizmu woluminów, aby przechowywać dane poza kontenerem. Woluminy są montowane do kontenera i przechowują dane poza warstwami kontenera, co pozwala na trwałe przechowywanie informacji nawet po zatrzymaniu lub usunięciu kontenera.
        </li>
    </ol>

    <p>Aby przechowywać dane trwale w kontenerach, często stosuje się techniki takie jak korzystanie z woluminów, zarządzanie danymi na poziomie hosta lub korzystanie z zewnętrznych rozwiązań do przechowywania danych, które są niezależne od cyklu życia kontenera.</p>
    
    <h1>Uruchomianie kontenerów z woluminami Dockera</h1>
    <p>Aby uruchomić kontener z woluminami w Dockerze, użyj flagi <code>-v</code> lub <code>--volume</code> w poleceniu <code>docker run</code>, aby zmapować lokalny katalog na katalog wewnątrz kontenera.</p>
    <div class="code-container">
        <pre><code>docker run -v /ścieżka/do/lokalnego/katalogu1:/ścieżka/do/katalogu1/w/kontenerze -v /ścieżka/do/lokalnego/katalogu2:/ścieżka/do/katalogu2/w/kontenerze nazwa_obrazu</code></pre>
    </div>
    <p>Przykładowo, aby uruchomić kontener na podstawie obrazu o nazwie <code>moj_obraz</code>, który będzie miał dostęp do katalogu <code>/app</code> wewnątrz kontenera i zmapować lokalny katalog <code>/home/user/moja_aplikacja</code> do tego katalogu, użyj poniższego polecenia:</p>
    <div class="code-container">
        <pre><code>docker run -v /home/user/moja_aplikacja:/app moj_obraz</code></pre>
    </div>
    <p>Możesz również użyć wielu flag <code>-v</code>, aby zmapować wiele woluminów.</p>
    <div class="code-container">
        <pre><code>docker run -v /ścieżka/do/lokalnego/katalogu1:/ścieżka/do/katalogu1/w/kontenerze -v /ścieżka/do/lokalnego/katalogu2:/ścieżka/do/katalogu2/w/kontenerze nazwa_obrazu</code></pre>
    </div>
    <p>W ten sposób możesz zapewnić dostęp do danych pomiędzy lokalnym systemem plików a kontenerem Dockerowym.</p>
  
    <h1>Uruchamianie kontenerów z dowiązaniami systemu plików</h1>
    <p>Aby uruchomić kontener z dowiązaniami systemu plików w Dockerze, można wykorzystać flagę <code>--mount</code> lub <code>-v</code> w poleceniu <code>docker run</code>.</p>
    <div class="code-container">
        <pre><code>docker run --mount type=bind,source=/ścieżka/do/lokalnego/katalogu,target=/ścieżka/w/kontenerze nazwa_obrazu</code></pre>
    </div>
    <p>Na przykład, aby uruchomić kontener na podstawie obrazu o nazwie <code>moj_obraz</code>, który będzie miał dostęp do katalogu <code>/app</code> wewnątrz kontenera i zmapować lokalny katalog <code>/home/user/moja_aplikacja</code> do tego katalogu, użyj poniższego polecenia:</p>
    <div class="code-container">
        <pre><code>docker run --mount type=bind,source=/home/user/moja_aplikacja,target=/app moj_obraz</code></pre>
    </div>
    <p>Można również użyć flagi <code>-v</code>, co jest skrótem dla <code>--mount type=bind</code>.</p>
    <div class="code-container">
        <pre><code>docker run -v /ścieżka/do/lokalnego/katalogu:/ścieżka/w/kontenerze nazwa_obrazu</code></pre>
    </div>
    <p>W ten sposób możesz zapewnić dostęp do danych pomiędzy lokalnym systemem plików a kontenerem Dockerowym.</p>

   <h1>Ograniczenia dowiązań</h1>
    <p>Ograniczenia dowiązań mogą prowadzić do pewnych problemów w kontenerach Dockerowych. Mimo że są one przydatne, mają swoje ograniczenia:</p>
    <ul>
        <li>Nie można montować pojedynczego pliku, tylko katalogi (dotyczy systemu Windows).</li>
        <li>Nie można przekazywać dowiązań systemu plików przy kopiowaniu lub eksportowaniu kontenera.</li>
        <li>Gdy katalog docelowy dowiązania już istnieje, katalog źródłowy w całości zastępuje istniejący katalog docelowy - innymi słowy, pierwotne pliki pochodzące z obrazu przestają być dostępne.</li>
    </ul>
    <p>Przy projektowaniu systemów z użyciem dowiązań systemu plików, należy uwzględnić te ograniczenia i zastanowić się, czy spełniają one wymagania projektu.</p>
    <p>W kontenerach z systemem Linux możliwe jest dowiązywanie pojedynczych plików. Jeżeli katalog docelowy będzie istnieć, to domontowany plik zostanie scalony z zawartością katalogu. Natomiast w kontenerach z systemem Windows nie można dowiązywać pojedynczych plików. Pojawi się błąd "invalid mount config". Ponadto, katalog rozproszonych systemów plików może zostać dowiązany, ale w rzeczywistości jest przechowywany w usłudze sieciowej. Nie obsługuje ona twardych dowiązań do plików, więc próba użycia tego katalogu przez bazę danych Postgres może doprowadzić do awarii.</p>


</body>
</html>
